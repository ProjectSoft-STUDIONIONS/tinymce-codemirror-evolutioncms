/**
 *
 * The source HTML code of the CodeMirror plugin
 *
 * plugin.js
 *
 * Copyright 2013 Web Power, www.webpower.nl
 * @author Arjan Haverkamp
 * @author ProjectSoft <projectsoft2009@yandex.ru>
 *
 */
!function(e){e.PluginManager.requireLangPack("codemirror"),e.PluginManager.add("codemirror",function(o,r){function i(){o.focus(),o.selection.collapse(!0);let i=o.settings.codemirror?Object.assign({},o.settings.codemirror):{};i.indentOnInit=!0,i.fullscreen=!!i.fullscreen,i.iframe=i.iframe?i.iframe:"source.html",i.path="codemirror",i.config=i.config?Object.assign(i.config,{mode:"application/x-httpd-php",lineNumbers:!0,indentUnit:4,tabSize:4,theme:"mariana"}):{mode:"application/x-httpd-php",lineNumbers:!0,indentUnit:4,tabSize:4,theme:"mariana"},i.saveCursorPosition=!!i.saveCursorPosition,i.jsFiles=i.jsFiles?i.jsFiles:["mode/php/php.js","addon/edit/matchbrackets.js","mode/xml/xml.js","mode/javascript/javascript.js","mode/css/css.js","mode/htmlmixed/htmlmixed.js","addon/selection/active-line.js"],i.cssFiles=i.cssFiles?i.cssFiles:["lib/codemirror.css","theme/mariana.css"],o.settings.codemirror=Object.assign({},i),o.settings.codemirror.saveCursorPosition&&o.selection.setContent('<span style="display: none;" class="CmCaReT">&#x0;</span>');var n=e.majorVersion<5?[{text:"Ok",subtype:"primary",onclick:function(){document.querySelectorAll(".mce-container-body>iframe")[0].contentWindow.submit(),s.close()}},{text:"Cancel",onclick:"close"}]:[{type:"custom",text:"Ok",name:"codemirrorOk",primary:!0},{type:"cancel",text:"Cancel",name:"codemirrorCancel"}],t={title:"The source HTML code of the CodeMirror plugin",url:r+"/"+o.settings.codemirror.iframe,classes:"codemirror-dialog codemirror-test",width:window.innerWidth-100,height:window.innerHeight-200,resizable:!0,maximizable:!0,fullScreen:o.settings.codemirror.fullscreen,saveCursorPosition:!0,buttons:n,size:"normal"};e.majorVersion>=5&&(t.onAction=function(e,r){"codemirrorOk"===r.name&&(document.querySelectorAll(".tox-dialog__body-iframe iframe")[0].contentWindow.submit(),o.undoManager.add(),s.close())});var s=e.majorVersion<5?o.windowManager.open(t):o.windowManager.openUrl(t);o.settings.codemirror.fullscreen&&s.fullscreen(!0)}e.majorVersion<5?(o.addButton("codemirror",{title:"The source HTML code of the CodeMirror plugin",image:tinymce.baseURL+"/plugins/codemirror/codemirror.svg",onclick:i}),o.addMenuItem("codemirror",{image:tinymce.baseURL+"/plugins/codemirror/codemirror.svg",text:"The source HTML code of the CodeMirror plugin",context:"tools",onclick:i})):(o.ui.registry.addButton("codemirror",{image:tinymce.baseURL+"/plugins/codemirror/codemirror.svg",title:"The source HTML code of the CodeMirror plugin",tooltip:"The source HTML code of the CodeMirror plugin",onAction:i}),o.ui.registry.addMenuItem("codemirror",{image:tinymce.baseURL+"/plugins/codemirror/codemirror.svg",text:"The source HTML code of the CodeMirror plugin",onAction:i,context:"tools"}))})}(tinymce);