var tinymce,editor,codemirror,CMsettings,chr=0,isMac=/macintosh|mac os/i.test(navigator.userAgent);function inArray(e,s){"use strict";return-1!=(s="|"+s.join("|")+"|").indexOf("|"+e+"|")}function start(){"use strict";if("function"!=typeof window.CodeMirror)return void alert('CodeMirror not found in "'+CMsettings.path+'", aborting...');let e,s=parent.document.createElement("img");if(s.src=tinymce.baseURL+"/plugins/codemirror/codemirror.svg",s.style="margin-right:10px;width:auto;height:20px;position:relative;",tinymce.majorVersion<5){if((e=parent.document.querySelector(".mce-title"))&&(e.prepend(s),!parent.document.querySelector("link#codemirror_plugin"))){let e=parent.document.createElement("link");e.id="codemirror_plugin",e.rel="stylesheet",e.type="text/css",e.href=tinymce.baseURL+"/plugins/codemirror/codemirror.css",parent.document.head.append(e)}}else(e=parent.document.querySelector(".tox-dialog__title"))&&e.prepend(s);var t=editor.getContent({source_view:!0});t=t.replace(/<span\s+style="display: none;"\s+class="CmCaReT"([^>]*)>([^<]*)<\/span>/gm,String.fromCharCode(chr)),editor.dom.remove(editor.dom.select(".CmCaReT")),tinymce.each(editor.contextToolbars,function(e){e.panel&&e.panel.hide()}),CodeMirror.defineInitHook(function(e){e.focus();var s=e.getSearchCursor(String.fromCharCode(chr),!1);if(s.findNext()&&(e.setCursor(s.to()),s.replace("")),editor.settings.codemirror.indentOnInit){var t=e.lineCount();e.operation(function(){for(var s=0;s<t;++s)e.indentLine(s)})}}),CMsettings.config.value=t,(codemirror=CodeMirror(document.body,CMsettings.config)).isDirty=!1,codemirror.on("change",function(e){e.isDirty=!0})}function findDepth(e,s){"use strict";var t,i=0;for(t=e.indexOf(s)-1;t>=0;t--)switch(e.charAt(t)){case"<":i--;break;case">":case"&":i++}return i}function submit(){"use strict";var e="&#x0;",s=codemirror.isDirty,t=codemirror.doc;t.somethingSelected()&&t.setCursor(t.getCursor()),t.replaceSelection(e);var i=codemirror.getCursor(),r=t.getLine(i.line);0!==findDepth(r,e)&&(r=r.replace(e,""),t.replaceRange(r,CodeMirror.Pos(i.line,0),CodeMirror.Pos(i.line)));var n=codemirror.getValue(),o=new RegExp("<script(.*?)>(.*?)&#x0;(.*?)<\/script>","ms"),c=new RegExp("<style(.*?)>(.*?)&#x0;(.*?)</style>","ms"),a=new RegExp("<[^>]*(&#x0;).*>|^(&#x0;)|(&#x0;)$");-1!==n.search(o)||-1!==n.search(c)||-1!==n.search(a)?editor.setContent(n.replace(e,"")):editor.setContent(n.replace(e,'<span id="CmCaReT"></span>')),editor.isNotDirty=!s,s&&editor.nodeChanged();var d=editor.dom.select("span#CmCaReT")[0];d&&(editor.selection.scrollIntoView(d),editor.selection.setCursorLocation(d,0),editor.dom.remove(d))}!function(){"use strict";tinymce=parent.tinymce;var e,s=(editor=tinymce.activeEditor).settings.codemirror?editor.settings.codemirror:{};for(e in CMsettings={path:s.path||"codemirror",indentOnInit:s.indentOnInit||!1,disableFilesMerge:s.disableFilesMerge||!1,config:{mode:"htmlmixed",theme:"default",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,indentWithTabs:!0,matchBrackets:!0,saveCursorPosition:!0,styleActiveLine:!0},jsFiles:["lib/codemirror.js","addon/edit/matchbrackets.js","mode/xml/xml.js","mode/javascript/javascript.js","mode/css/css.js","mode/htmlmixed/htmlmixed.js","addon/dialog/dialog.js","addon/search/searchcursor.js","addon/selection/active-line.js"],cssFiles:["lib/codemirror.css","addon/dialog/dialog.css"]},s.fullscreen&&(CMsettings.jsFiles.push("addon/display/fullscreen.js"),CMsettings.cssFiles.push("addon/display/fullscreen.css")),CMsettings.disableFilesMerge&&(Array.isArray(s.jsFiles)&&Array.isArray(s.cssFiles)&&s.jsFiles.length>0&&s.cssFiles.length>0?(CMsettings.jsFiles=[],CMsettings.cssFiles=[]):console&&(console.error("Codemirror plugin: jsFiles and cssFiles must be specified if disableFilesMerge is set to true"),console.warn("Codemirror plugin: ignoring disableFilesMerge"))),s.config)CMsettings.config[e]=s.config[e];for(e in s.jsFiles)inArray(s.jsFiles[e],CMsettings.jsFiles)||CMsettings.jsFiles.push(s.jsFiles[e]);for(e in s.cssFiles)inArray(s.cssFiles[e],CMsettings.cssFiles)||CMsettings.cssFiles.push(s.cssFiles[e]);for(/\/$/.test(CMsettings.path)||(CMsettings.path+="/"),e=0;e<CMsettings.cssFiles.length;e++)document.write('<link rel="stylesheet" type="text/css" href="'+CMsettings.path+CMsettings.cssFiles[e]+'" />');for(e=0;e<CMsettings.jsFiles.length;e++)document.write('<script type="text/javascript" src="'+CMsettings.path+CMsettings.jsFiles[e]+'"><\/script>');CMsettings.config.theme&&(document.documentElement.className+=CMsettings.config.theme.replace(/(^|\s)\s*/g," cm-s-")),window.onload=start}(),document.onkeydown=function(e){("key"in(e=e||window.event)?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&tinymce.activeEditor.windowManager.close()};